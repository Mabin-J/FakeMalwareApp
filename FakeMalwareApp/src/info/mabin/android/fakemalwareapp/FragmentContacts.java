package info.mabin.android.fakemalwareapp;

import info.mabin.android.fakemalwareapp.R;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import com.actionbarsherlock.app.SherlockFragment;

import android.database.Cursor;
import android.net.Uri;
import android.os.Bundle;
import android.provider.ContactsContract;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ListView;

    public class FragmentContacts extends SherlockFragment {
    	List<Map<String, String>> contacts;
    	
        @Override
        public View onCreateView(LayoutInflater inflater, ViewGroup container,
                Bundle savedInstanceState) {
            View rootView = inflater.inflate(R.layout.fragment_contacts, container, false);
            
            ListView listViewContacts = (ListView) rootView.findViewById(R.id.listViewContacts);
            
            contacts = new ArrayList<Map<String, String>>();
            
            Uri uri = ContactsContract.CommonDataKinds.Phone.CONTENT_URI;
    		String[] projection = new String[] {
    				ContactsContract.CommonDataKinds.Phone._ID,
    				ContactsContract.CommonDataKinds.Phone.DISPLAY_NAME,
    				ContactsContract.CommonDataKinds.Phone.PHOTO_ID,
    				ContactsContract.CommonDataKinds.Phone.NUMBER
    		};
    		
    		String selection = ContactsContract.Contacts.IN_VISIBLE_GROUP + " = '"
    				+ ("1") + "'";
    		String[] selectionArgs = null;
    		String sortOrder = ContactsContract.Contacts.DISPLAY_NAME
    				+ " COLLATE LOCALIZED ASC";


    		Cursor cursor = getActivity().managedQuery(uri, projection, selection, selectionArgs, sortOrder);

    		while (cursor.moveToNext()){
    			Map<String, String> item = new HashMap<String, String>(5);

    			item.put("contact_name", cursor.getString(1));
    			contacts.add(item);
    		}
            
    		Log.d("amouont", contacts.size() + "");
    		
            AdapterContacts adapterContacts = new AdapterContacts(getActivity(), R.layout.listitem_contacts, contacts);
            
            listViewContacts.setAdapter(adapterContacts);
            return rootView;
        }
    }